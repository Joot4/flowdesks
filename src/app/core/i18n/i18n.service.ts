import { Injectable, Signal, computed, signal } from '@angular/core';

export type AppLanguage = 'pt-BR' | 'en' | 'es';

const STORAGE_KEY = 'flowdesks.lang';

const DICTIONARY: Record<AppLanguage, Record<string, string>> = {
  'pt-BR': {
    'app.subtitle': 'Gestao de Colaboradores',
    'app.punch': 'Ponto',
    'app.requests': 'Solicitacoes',
    'app.profile': 'Perfil',
    'app.account': 'Conta',
    'app.logout': 'Sair',
    'app.offline': 'Modo offline: somente leitura de cache local.',
    'lang.label': 'Idioma',
    'lang.pt': 'Portugues',
    'lang.en': 'Ingles',
    'lang.es': 'Espanhol',

    'login.welcome': 'Bem-vindo de volta',
    'login.subtitle': 'Entre para acessar o painel operacional.',
    'login.email': 'Email',
    'login.password': 'Senha',
    'login.entering': 'Entrando...',
    'login.enter': 'Entrar',

    'nav.calendar': 'Calendario',
    'nav.employees': 'Colaboradores',
    'nav.locations': 'Locais',
    'nav.activities': 'Atividades',
    'nav.photos': 'Fotos',
    'director.admins': 'Administradores',

    'employees.title': 'Colaboradores',
    'employees.add': 'Adicionar colaborador',
    'employees.adding': 'Cadastrando...',
    'common.name': 'Nome',
    'common.code': 'Matricula',
    'common.job': 'Cargo',
    'common.actions': 'Acoes',
    'common.edit': 'Editar',
    'common.delete': 'Excluir',
    'common.all': 'Todos',
    'common.defaultActivity': 'Atividade',
    'common.noLocation': 'Sem local',
    'common.noName': 'Sem nome',
    'common.collaborator': 'Colaborador',

    'locations.title': 'Locais',
    'locations.address': 'Endereco',
    'locations.state': 'UF / State',
    'locations.radius': 'Raio cercado (m)',
    'locations.mapsLink': 'Link Maps',
    'locations.detectHelp': 'Cole o link do Maps para detectar coordenadas automaticamente.',
    'locations.active': 'Ativo',
    'common.save': 'Salvar',
    'locations.status': 'Status',
    'locations.maps': 'Maps',
    'locations.openMap': 'Abrir mapa',
    'locations.geofence': 'Cercado',

    'activities.title': 'Tipos de atividade',
    'photos.title': 'Fotos de trabalho',
    'photos.subtitle': 'Consulte evidencias com filtros por periodo, local, colaborador e GPS.',
    'photos.periodStart': 'Periodo inicial',
    'photos.periodEnd': 'Periodo final',
    'photos.employee': 'Colaborador',
    'photos.location': 'Local',
    'photos.phase': 'Fase',
    'photos.gps': 'GPS',
    'photos.phaseAll': 'Todas',
    'photos.phaseBefore': 'Antes',
    'photos.phaseAfter': 'Depois',
    'photos.gpsAll': 'Todos',
    'photos.gpsWith': 'Com coordenadas',
    'photos.gpsWithout': 'Sem coordenadas',
    'photos.apply': 'Aplicar',
    'photos.clear': 'Limpar',
    'photos.total': 'Total de fotos',
    'photos.empty': 'Nenhuma foto encontrada com os filtros atuais.',
    'photos.capturedAt': 'Capturada em',
    'photos.uploadedAt': 'Upload em',
    'photos.assignmentWindow': 'Janela da alocacao',
    'photos.coords': 'Coordenadas',
    'photos.accuracy': 'Precisao',
    'photos.heading': 'Direcao',
    'photos.openMap': 'Abrir mapa',
    'photos.download': 'Baixar',
    'photos.noCoords': 'Sem coordenadas',
    'photos.loadError': 'Erro ao carregar fotos.',
    'photos.groupBy': 'Agrupar por',
    'photos.groupNone': 'Sem agrupamento',
    'photos.groupEmployee': 'Colaborador',
    'photos.groupLocation': 'Local',
    'photos.groupDay': 'Dia',
    'photos.downloadFiltered': 'Baixar filtradas',
    'photos.downloadGroup': 'Baixar grupo',
    'photos.downloadStarted': 'Download iniciado para {count} fotos.',
    'photos.downloadZipError': 'Nao foi possivel gerar o arquivo ZIP.',

    'calendar.title': 'Agenda operacional',
    'calendar.subtitle': 'Planeje, confirme e remaneje escalas com arrastar e soltar.',
    'calendar.total': 'Total',
    'calendar.confirmed': 'Confirmados',
    'calendar.planned': 'Planejados',
    'calendar.cancelled': 'Cancelados',
    'calendar.employee': 'Colaborador',
    'calendar.location': 'Local',
    'calendar.activity': 'Atividade',
    'calendar.status': 'Status',
    'calendar.periodStart': 'Periodo inicial',
    'calendar.periodEnd': 'Periodo final',
    'calendar.applyFilters': 'Aplicar filtros',
    'calendar.clear': 'Limpar',
    'calendar.exportExcel': 'Exportar Excel',
    'calendar.loadedAssignments': 'Alocacoes da janela carregada',
    'calendar.reassign': 'Remanejar',
    'calendar.delete': 'Excluir',
    'calendar.defaultDone': 'DONE',
    'calendar.tabPast': 'Antigas',
    'calendar.tabToday': 'Hoje',
    'calendar.tabFuture': 'Futuras',
    'calendar.mobileEmptyDay': 'Sem alocacoes para este dia.',
    'calendar.attendancePrefix': 'Ponto',
    'calendar.photoBefore': 'Foto antes',
    'calendar.photoAfter': 'Foto depois',
    'calendar.emptyTab': 'Nenhuma alocacao nesta aba.',
    'calendar.offlineBlocked': 'Sem internet: criacao/edicao bloqueadas no modo offline.',
    'calendar.offlineReviewBlocked': 'Sem internet: aprovacao/rejeicao bloqueada no modo offline.',
    'calendar.errorLoadAgenda': 'Erro ao carregar agenda.',
    'calendar.errorProcessRequest': 'Erro ao processar solicitacao.',
    'calendar.nothingToExport': 'Nao ha alocacoes para exportar.',
    'calendar.saved': 'Alocacao salva.',
    'calendar.savedWithRepeats': 'Alocacao salva com {count} repeticoes.',
    'calendar.seriesUpdated': 'Serie atualizada.',
    'calendar.datesUpdated': 'Datas atualizadas.',
    'calendar.deleted': 'Alocacao removida.',
    'calendar.recurrenceDeleted': 'Serie de repeticao removida.',
    'calendar.reassignDone': 'Remanejamento concluido.',
    'calendar.conflictError': 'Conflito de horario: colaborador ja possui alocacao nesse intervalo.',
    'calendar.saveError': 'Erro ao salvar alocacao.',
    'calendar.deleteRepeatTitle': 'Excluir repeticao',
    'calendar.deleteRepeatMessage': 'Escolha como deseja excluir esta alocacao repetida.',
    'calendar.deleteSeries': 'Excluir serie',
    'calendar.deleteThis': 'Excluir esta',
    'calendar.deleteAssignmentTitle': 'Excluir alocacao',
    'calendar.deleteAssignmentMessage': 'Deseja remover esta alocacao?',

    'me.title': 'Meu ponto',
    'me.subtitle': 'Resumo rapido do seu dia de trabalho.',
    'me.upcoming': 'Proximas alocacoes',
    'me.done': 'Concluidas',
    'me.pending': 'Pendentes',
    'me.history': 'Historico do meu trabalho',
    'me.activeCommitments': 'Compromissos ativos',
    'me.noUpcoming': 'Sem proximas alocacoes.',
    'me.noHistoryLoaded': 'Sem historico no periodo carregado.',
    'me.attendanceStatus': 'Status ponto',
    'me.photosCount': 'Fotos',
    'me.punchRecording': 'Registrando ponto...',
    'me.photosLoading': 'Carregando fotos...',
    'me.punchOffline': 'Sem internet: nao e possivel bater ponto no modo offline.',
    'me.checkinSuccess': 'Entrada registrada com sucesso.',
    'me.checkoutSuccess': 'Saida registrada com sucesso.',
    'me.photosUploadOffline': 'Sem internet: nao e possivel enviar fotos no modo offline.',
    'me.photosUploadSuccess': 'Fotos enviadas com sucesso.',
    'me.photosUploadError': 'Nao foi possivel enviar as fotos.',
    'me.photoDeleteSuccess': 'Foto removida com sucesso.',
    'me.photoDeleteError': 'Nao foi possivel remover a foto.',
    'me.photoDeleteOffline': 'Sem internet: nao e possivel excluir fotos no modo offline.',
    'me.requestOffline': 'Sem internet: nao e possivel solicitar ajuste no modo offline.',
    'me.requestSuccess': 'Solicitacao enviada para o administrador.',
    'me.requestError': 'Nao foi possivel enviar a solicitacao.',
    'me.geoNotSupported': 'Geolocalizacao nao suportada neste dispositivo.',
    'me.geoFetchError': 'Nao foi possivel obter localizacao atual.',
    'me.punchErrorDefault': 'Nao foi possivel registrar ponto.',
    'me.punchErrorOutsideGeofence': 'Voce esta fora do cercado virtual permitido para este local.',
    'me.punchErrorLocationRequired': 'Para este local, ative a localizacao do celular para bater ponto.',
    'me.punchErrorLowAccuracy': 'GPS com baixa precisao. Tente novamente em area aberta.',
    'me.punchErrorCheckinWindowClosed': 'Horario encerrado: o prazo para fazer check-in nesta alocacao ja terminou.',
    'me.punchErrorCheckinNotOpen': 'Ainda nao liberado: o check-in so fica disponivel 30 minutos antes do inicio.',
    'me.punchErrorNeedCheckinFirst': 'Voce precisa fazer o check-in antes de registrar a saida.',
    'me.punchErrorInvalidCheckout': 'Horario invalido para check-out.',

    'profile.title': 'Meu perfil',
    'profile.security': 'Seguranca',
    'profile.save': 'Salvar perfil',
    'profile.newPassword': 'Nova senha',
    'profile.confirmPassword': 'Confirmar senha',
    'profile.updatePassword': 'Atualizar senha',

    'assignment.details': 'Detalhes da alocacao',
    'common.close': 'Fechar',
    'assignment.checkin': 'Bater entrada',
    'assignment.checkout': 'Bater saida',

    'assignment.start': 'Inicio',
    'assignment.end': 'Fim',
    'assignment.activityLabel': 'Atividade',
    'assignment.locationLabel': 'Local',
    'assignment.addressLabel': 'Endereco',
    'assignment.detailsLabel': 'Detalhes',
    'assignment.punchLabel': 'Ponto',
    'assignment.notProvidedFemale': 'Nao informada',
    'assignment.notProvidedMale': 'Nao informado',
    'assignment.noNotes': 'Sem observacoes',
    'assignment.tabPunch': 'Ponto',
    'assignment.tabRequest': 'Solicitacao de ajuste',
    'assignment.photoBeforeRegistered': 'Foto antes (registrada)',
    'assignment.photoAfterRegistered': 'Foto depois (registrada)',
    'assignment.workPhotosBefore': 'Fotos do trabalho - Antes',
    'assignment.workPhotosAfter': 'Fotos do trabalho - Depois',
    'assignment.previewBefore': 'Preview antes',
    'assignment.previewAfter': 'Preview depois',
    'assignment.photoBeforeWork': 'Foto antes do trabalho',
    'assignment.photoAfterWork': 'Foto depois do trabalho',
    'assignment.uploadBeforePhotos': 'Enviar fotos antes',
    'assignment.uploadAfterPhotos': 'Enviar fotos depois',
    'assignment.request.title': 'Solicitacao de ajuste de ponto',
    'assignment.request.subtitle': 'Use quando voce esquecer de bater o ponto no horario.',
    'assignment.request.suggestedType': 'Tipo sugerido',
    'assignment.request.suggestedIn': 'Entrada',
    'assignment.request.suggestedOut': 'Saida',
    'assignment.request.time': 'Horario solicitado',
    'assignment.request.reason': 'Motivo',
    'assignment.request.reasonPlaceholder': 'Ex.: esqueci de registrar no momento da entrada',
    'assignment.request.submit': 'Enviar solicitacao',

    'requests.title': 'Minhas solicitacoes de ponto',
    'requests.subtitle': 'Acompanhe aqui as solicitacoes enviadas para aprovacao.',
    'requests.refresh': 'Atualizar',
    'requests.typeIn': 'Entrada',
    'requests.typeOut': 'Saida',
    'requests.requestedFor': 'Solicitado para',
    'requests.reason': 'Motivo',
    'requests.noReason': 'Sem motivo informado',
    'requests.assignment': 'Alocacao',
    'requests.adminNote': 'Nota do admin',
    'requests.empty': 'Nenhuma solicitacao registrada.',
    'requests.loadError': 'Erro ao carregar solicitacoes.',

    'calendar.desktopViewAssignments': 'Alocacoes',
    'calendar.desktopViewAttendance': 'Historico de ponto',
    'calendar.workPhotosCount': 'Fotos do trabalho',
    'calendar.requests.title': 'Solicitacoes de ajuste de ponto',
    'calendar.requests.type': 'Tipo',
    'calendar.requests.requestedFor': 'Solicitado para',
    'calendar.requests.reason': 'Motivo',
    'calendar.requests.noReason': 'Sem motivo informado',
    'calendar.requests.assignment': 'Alocacao',
    'calendar.requests.approve': 'Aprovar',
    'calendar.requests.reject': 'Rejeitar',
    'calendar.requests.empty': 'Nenhuma solicitacao pendente.',
    'calendar.requests.approvedToast': 'Solicitacao aprovada.',
    'calendar.requests.rejectedToast': 'Solicitacao rejeitada.',
    'calendar.attendanceHistory.title': 'Historico de ponto (janela carregada)',
    'calendar.attendanceHistory.status': 'Status',
    'calendar.attendanceHistory.photos': 'Fotos',
    'calendar.attendanceHistory.entry': 'Entrada',
    'calendar.attendanceHistory.exit': 'Saida',
    'calendar.attendanceHistory.empty': 'Nenhum ponto registrado na janela atual.'
  },
  en: {
    'app.subtitle': 'Workforce Management',
    'app.punch': 'Punch',
    'app.requests': 'Requests',
    'app.profile': 'Profile',
    'app.account': 'Account',
    'app.logout': 'Logout',
    'app.offline': 'Offline mode: local cache read-only.',
    'lang.label': 'Language',
    'lang.pt': 'Portuguese',
    'lang.en': 'English',
    'lang.es': 'Spanish',

    'login.welcome': 'Welcome back',
    'login.subtitle': 'Sign in to access the operations panel.',
    'login.email': 'Email',
    'login.password': 'Password',
    'login.entering': 'Signing in...',
    'login.enter': 'Sign in',

    'nav.calendar': 'Calendar',
    'nav.employees': 'Employees',
    'nav.locations': 'Locations',
    'nav.activities': 'Activities',
    'nav.photos': 'Photos',
    'director.admins': 'Administrators',

    'employees.title': 'Employees',
    'employees.add': 'Add employee',
    'employees.adding': 'Creating...',
    'common.name': 'Name',
    'common.code': 'ID Code',
    'common.job': 'Role',
    'common.actions': 'Actions',
    'common.edit': 'Edit',
    'common.delete': 'Delete',
    'common.all': 'All',
    'common.defaultActivity': 'Activity',
    'common.noLocation': 'No location',
    'common.noName': 'No name',
    'common.collaborator': 'Collaborator',

    'locations.title': 'Locations',
    'locations.address': 'Address',
    'locations.state': 'State',
    'locations.radius': 'Geofence radius (m)',
    'locations.mapsLink': 'Maps URL',
    'locations.detectHelp': 'Paste a Maps link to detect coordinates automatically.',
    'locations.active': 'Active',
    'common.save': 'Save',
    'locations.status': 'Status',
    'locations.maps': 'Maps',
    'locations.openMap': 'Open map',
    'locations.geofence': 'Geofence',

    'activities.title': 'Activity types',
    'photos.title': 'Work photos',
    'photos.subtitle': 'Review evidences with period, location, collaborator and GPS filters.',
    'photos.periodStart': 'Start period',
    'photos.periodEnd': 'End period',
    'photos.employee': 'Collaborator',
    'photos.location': 'Location',
    'photos.phase': 'Phase',
    'photos.gps': 'GPS',
    'photos.phaseAll': 'All',
    'photos.phaseBefore': 'Before',
    'photos.phaseAfter': 'After',
    'photos.gpsAll': 'All',
    'photos.gpsWith': 'With coordinates',
    'photos.gpsWithout': 'Without coordinates',
    'photos.apply': 'Apply',
    'photos.clear': 'Clear',
    'photos.total': 'Total photos',
    'photos.empty': 'No photos found with current filters.',
    'photos.capturedAt': 'Captured at',
    'photos.uploadedAt': 'Uploaded at',
    'photos.assignmentWindow': 'Assignment window',
    'photos.coords': 'Coordinates',
    'photos.accuracy': 'Accuracy',
    'photos.heading': 'Heading',
    'photos.openMap': 'Open map',
    'photos.download': 'Download',
    'photos.noCoords': 'No coordinates',
    'photos.loadError': 'Failed to load photos.',
    'photos.groupBy': 'Group by',
    'photos.groupNone': 'No grouping',
    'photos.groupEmployee': 'Collaborator',
    'photos.groupLocation': 'Location',
    'photos.groupDay': 'Day',
    'photos.downloadFiltered': 'Download filtered',
    'photos.downloadGroup': 'Download group',
    'photos.downloadStarted': 'Download started for {count} photos.',
    'photos.downloadZipError': 'Could not generate ZIP file.',

    'calendar.title': 'Operations calendar',
    'calendar.subtitle': 'Plan, confirm and reassign shifts with drag and drop.',
    'calendar.total': 'Total',
    'calendar.confirmed': 'Confirmed',
    'calendar.planned': 'Planned',
    'calendar.cancelled': 'Cancelled',
    'calendar.employee': 'Employee',
    'calendar.location': 'Location',
    'calendar.activity': 'Activity',
    'calendar.status': 'Status',
    'calendar.periodStart': 'Start period',
    'calendar.periodEnd': 'End period',
    'calendar.applyFilters': 'Apply filters',
    'calendar.clear': 'Clear',
    'calendar.exportExcel': 'Export Excel',
    'calendar.loadedAssignments': 'Assignments in current window',
    'calendar.reassign': 'Reassign',
    'calendar.delete': 'Delete',
    'calendar.defaultDone': 'DONE',
    'calendar.tabPast': 'Past',
    'calendar.tabToday': 'Today',
    'calendar.tabFuture': 'Future',
    'calendar.mobileEmptyDay': 'No assignments for this day.',
    'calendar.attendancePrefix': 'Attendance',
    'calendar.photoBefore': 'Before photo',
    'calendar.photoAfter': 'After photo',
    'calendar.emptyTab': 'No assignments in this tab.',
    'calendar.offlineBlocked': 'No internet: create/edit actions are blocked in offline mode.',
    'calendar.offlineReviewBlocked': 'No internet: approve/reject is blocked in offline mode.',
    'calendar.errorLoadAgenda': 'Failed to load agenda.',
    'calendar.errorProcessRequest': 'Failed to process request.',
    'calendar.nothingToExport': 'No assignments to export.',
    'calendar.saved': 'Assignment saved.',
    'calendar.savedWithRepeats': 'Assignment saved with {count} repetitions.',
    'calendar.seriesUpdated': 'Series updated.',
    'calendar.datesUpdated': 'Dates updated.',
    'calendar.deleted': 'Assignment removed.',
    'calendar.recurrenceDeleted': 'Recurring series removed.',
    'calendar.reassignDone': 'Reassignment completed.',
    'calendar.conflictError': 'Schedule conflict: collaborator already has an assignment in this interval.',
    'calendar.saveError': 'Failed to save assignment.',
    'calendar.deleteRepeatTitle': 'Delete recurrence',
    'calendar.deleteRepeatMessage': 'Choose how to delete this recurring assignment.',
    'calendar.deleteSeries': 'Delete series',
    'calendar.deleteThis': 'Delete this one',
    'calendar.deleteAssignmentTitle': 'Delete assignment',
    'calendar.deleteAssignmentMessage': 'Do you want to remove this assignment?',

    'me.title': 'My timesheet',
    'me.subtitle': 'Quick summary of your workday.',
    'me.upcoming': 'Upcoming assignments',
    'me.done': 'Completed',
    'me.pending': 'Pending',
    'me.history': 'Work history',
    'me.activeCommitments': 'Active commitments',
    'me.noUpcoming': 'No upcoming assignments.',
    'me.noHistoryLoaded': 'No history in loaded period.',
    'me.attendanceStatus': 'Attendance status',
    'me.photosCount': 'Photos',
    'me.punchRecording': 'Recording punch...',
    'me.photosLoading': 'Loading photos...',
    'me.punchOffline': 'No internet: punch is unavailable in offline mode.',
    'me.checkinSuccess': 'Check-in recorded successfully.',
    'me.checkoutSuccess': 'Check-out recorded successfully.',
    'me.photosUploadOffline': 'No internet: photo upload is unavailable in offline mode.',
    'me.photosUploadSuccess': 'Photos uploaded successfully.',
    'me.photosUploadError': 'Could not upload photos.',
    'me.photoDeleteSuccess': 'Photo removed successfully.',
    'me.photoDeleteError': 'Could not remove photo.',
    'me.photoDeleteOffline': 'No internet: photo delete is unavailable in offline mode.',
    'me.requestOffline': 'No internet: adjustment request is unavailable in offline mode.',
    'me.requestSuccess': 'Request sent to administrator.',
    'me.requestError': 'Could not send request.',
    'me.geoNotSupported': 'Geolocation is not supported on this device.',
    'me.geoFetchError': 'Could not get current location.',
    'me.punchErrorDefault': 'Could not register punch.',
    'me.punchErrorOutsideGeofence': 'You are outside the allowed geofence for this location.',
    'me.punchErrorLocationRequired': 'For this location, enable mobile location to punch.',
    'me.punchErrorLowAccuracy': 'Low GPS accuracy. Try again in an open area.',
    'me.punchErrorCheckinWindowClosed': 'Window closed: check-in deadline for this assignment has passed.',
    'me.punchErrorCheckinNotOpen': 'Not available yet: check-in is enabled only 30 minutes before start.',
    'me.punchErrorNeedCheckinFirst': 'You must check in before checking out.',
    'me.punchErrorInvalidCheckout': 'Invalid time for check-out.',

    'profile.title': 'My profile',
    'profile.security': 'Security',
    'profile.save': 'Save profile',
    'profile.newPassword': 'New password',
    'profile.confirmPassword': 'Confirm password',
    'profile.updatePassword': 'Update password',

    'assignment.details': 'Assignment details',
    'common.close': 'Close',
    'assignment.checkin': 'Check in',
    'assignment.checkout': 'Check out',

    'assignment.start': 'Start',
    'assignment.end': 'End',
    'assignment.activityLabel': 'Activity',
    'assignment.locationLabel': 'Location',
    'assignment.addressLabel': 'Address',
    'assignment.detailsLabel': 'Details',
    'assignment.punchLabel': 'Punch',
    'assignment.notProvidedFemale': 'Not provided',
    'assignment.notProvidedMale': 'Not provided',
    'assignment.noNotes': 'No notes',
    'assignment.tabPunch': 'Punch',
    'assignment.tabRequest': 'Adjustment request',
    'assignment.photoBeforeRegistered': 'Before photo (saved)',
    'assignment.photoAfterRegistered': 'After photo (saved)',
    'assignment.workPhotosBefore': 'Work photos - Before',
    'assignment.workPhotosAfter': 'Work photos - After',
    'assignment.previewBefore': 'Before preview',
    'assignment.previewAfter': 'After preview',
    'assignment.photoBeforeWork': 'Before work photo',
    'assignment.photoAfterWork': 'After work photo',
    'assignment.uploadBeforePhotos': 'Upload before photos',
    'assignment.uploadAfterPhotos': 'Upload after photos',
    'assignment.request.title': 'Attendance adjustment request',
    'assignment.request.subtitle': 'Use this when you forget to punch at the right time.',
    'assignment.request.suggestedType': 'Suggested type',
    'assignment.request.suggestedIn': 'Check-in',
    'assignment.request.suggestedOut': 'Check-out',
    'assignment.request.time': 'Requested time',
    'assignment.request.reason': 'Reason',
    'assignment.request.reasonPlaceholder': 'e.g. I forgot to register at check-in time',
    'assignment.request.submit': 'Send request',

    'requests.title': 'My attendance requests',
    'requests.subtitle': 'Track the requests you sent for approval.',
    'requests.refresh': 'Refresh',
    'requests.typeIn': 'Check-in',
    'requests.typeOut': 'Check-out',
    'requests.requestedFor': 'Requested for',
    'requests.reason': 'Reason',
    'requests.noReason': 'No reason provided',
    'requests.assignment': 'Assignment',
    'requests.adminNote': 'Admin note',
    'requests.empty': 'No requests found.',
    'requests.loadError': 'Failed to load requests.',

    'calendar.desktopViewAssignments': 'Assignments',
    'calendar.desktopViewAttendance': 'Attendance history',
    'calendar.workPhotosCount': 'Work photos',
    'calendar.requests.title': 'Attendance adjustment requests',
    'calendar.requests.type': 'Type',
    'calendar.requests.requestedFor': 'Requested for',
    'calendar.requests.reason': 'Reason',
    'calendar.requests.noReason': 'No reason provided',
    'calendar.requests.assignment': 'Assignment',
    'calendar.requests.approve': 'Approve',
    'calendar.requests.reject': 'Reject',
    'calendar.requests.empty': 'No pending requests.',
    'calendar.requests.approvedToast': 'Request approved.',
    'calendar.requests.rejectedToast': 'Request rejected.',
    'calendar.attendanceHistory.title': 'Attendance history (loaded window)',
    'calendar.attendanceHistory.status': 'Status',
    'calendar.attendanceHistory.photos': 'Photos',
    'calendar.attendanceHistory.entry': 'Check-in',
    'calendar.attendanceHistory.exit': 'Check-out',
    'calendar.attendanceHistory.empty': 'No attendance records in the current range.'
  },
  es: {
    'app.subtitle': 'Gestion de Colaboradores',
    'app.punch': 'Fichaje',
    'app.requests': 'Solicitudes',
    'app.profile': 'Perfil',
    'app.account': 'Cuenta',
    'app.logout': 'Salir',
    'app.offline': 'Modo sin conexion: solo lectura del cache local.',
    'lang.label': 'Idioma',
    'lang.pt': 'Portugues',
    'lang.en': 'Ingles',
    'lang.es': 'Espanol',

    'login.welcome': 'Bienvenido de nuevo',
    'login.subtitle': 'Inicia sesion para acceder al panel operativo.',
    'login.email': 'Correo',
    'login.password': 'Contrasena',
    'login.entering': 'Ingresando...',
    'login.enter': 'Entrar',

    'nav.calendar': 'Calendario',
    'nav.employees': 'Colaboradores',
    'nav.locations': 'Locales',
    'nav.activities': 'Actividades',
    'nav.photos': 'Fotos',
    'director.admins': 'Administradores',

    'employees.title': 'Colaboradores',
    'employees.add': 'Agregar colaborador',
    'employees.adding': 'Creando...',
    'common.name': 'Nombre',
    'common.code': 'Matricula',
    'common.job': 'Cargo',
    'common.actions': 'Acciones',
    'common.edit': 'Editar',
    'common.delete': 'Eliminar',
    'common.all': 'Todos',
    'common.defaultActivity': 'Actividad',
    'common.noLocation': 'Sin local',
    'common.noName': 'Sin nombre',
    'common.collaborator': 'Colaborador',

    'locations.title': 'Locales',
    'locations.address': 'Direccion',
    'locations.state': 'Estado',
    'locations.radius': 'Radio geocerca (m)',
    'locations.mapsLink': 'Link Maps',
    'locations.detectHelp': 'Pega un link de Maps para detectar coordenadas automaticamente.',
    'locations.active': 'Activo',
    'common.save': 'Guardar',
    'locations.status': 'Estado',
    'locations.maps': 'Maps',
    'locations.openMap': 'Abrir mapa',
    'locations.geofence': 'Geocerca',

    'activities.title': 'Tipos de actividad',
    'photos.title': 'Fotos de trabajo',
    'photos.subtitle': 'Consulta evidencias con filtros por periodo, local, colaborador y GPS.',
    'photos.periodStart': 'Periodo inicial',
    'photos.periodEnd': 'Periodo final',
    'photos.employee': 'Colaborador',
    'photos.location': 'Local',
    'photos.phase': 'Fase',
    'photos.gps': 'GPS',
    'photos.phaseAll': 'Todas',
    'photos.phaseBefore': 'Antes',
    'photos.phaseAfter': 'Despues',
    'photos.gpsAll': 'Todos',
    'photos.gpsWith': 'Con coordenadas',
    'photos.gpsWithout': 'Sin coordenadas',
    'photos.apply': 'Aplicar',
    'photos.clear': 'Limpiar',
    'photos.total': 'Total de fotos',
    'photos.empty': 'No hay fotos con los filtros actuales.',
    'photos.capturedAt': 'Capturada en',
    'photos.uploadedAt': 'Subida en',
    'photos.assignmentWindow': 'Ventana de asignacion',
    'photos.coords': 'Coordenadas',
    'photos.accuracy': 'Precision',
    'photos.heading': 'Direccion',
    'photos.openMap': 'Abrir mapa',
    'photos.download': 'Descargar',
    'photos.noCoords': 'Sin coordenadas',
    'photos.loadError': 'Error al cargar fotos.',
    'photos.groupBy': 'Agrupar por',
    'photos.groupNone': 'Sin agrupacion',
    'photos.groupEmployee': 'Colaborador',
    'photos.groupLocation': 'Local',
    'photos.groupDay': 'Dia',
    'photos.downloadFiltered': 'Descargar filtradas',
    'photos.downloadGroup': 'Descargar grupo',
    'photos.downloadStarted': 'Descarga iniciada para {count} fotos.',
    'photos.downloadZipError': 'No fue posible generar el archivo ZIP.',

    'calendar.title': 'Calendario operativo',
    'calendar.subtitle': 'Planifica, confirma y reasigna turnos con arrastrar y soltar.',
    'calendar.total': 'Total',
    'calendar.confirmed': 'Confirmados',
    'calendar.planned': 'Planificados',
    'calendar.cancelled': 'Cancelados',
    'calendar.employee': 'Colaborador',
    'calendar.location': 'Local',
    'calendar.activity': 'Actividad',
    'calendar.status': 'Estado',
    'calendar.periodStart': 'Periodo inicial',
    'calendar.periodEnd': 'Periodo final',
    'calendar.applyFilters': 'Aplicar filtros',
    'calendar.clear': 'Limpiar',
    'calendar.exportExcel': 'Exportar Excel',
    'calendar.loadedAssignments': 'Asignaciones de la ventana cargada',
    'calendar.reassign': 'Reasignar',
    'calendar.delete': 'Eliminar',
    'calendar.defaultDone': 'DONE',
    'calendar.tabPast': 'Antiguas',
    'calendar.tabToday': 'Hoy',
    'calendar.tabFuture': 'Futuras',
    'calendar.mobileEmptyDay': 'Sin asignaciones para este dia.',
    'calendar.attendancePrefix': 'Fichaje',
    'calendar.photoBefore': 'Foto antes',
    'calendar.photoAfter': 'Foto despues',
    'calendar.emptyTab': 'No hay asignaciones en esta pesta√±a.',
    'calendar.offlineBlocked': 'Sin internet: creacion/edicion bloqueadas en modo offline.',
    'calendar.offlineReviewBlocked': 'Sin internet: aprobar/rechazar bloqueado en modo offline.',
    'calendar.errorLoadAgenda': 'Error al cargar agenda.',
    'calendar.errorProcessRequest': 'Error al procesar solicitud.',
    'calendar.nothingToExport': 'No hay asignaciones para exportar.',
    'calendar.saved': 'Asignacion guardada.',
    'calendar.savedWithRepeats': 'Asignacion guardada con {count} repeticiones.',
    'calendar.seriesUpdated': 'Serie actualizada.',
    'calendar.datesUpdated': 'Fechas actualizadas.',
    'calendar.deleted': 'Asignacion eliminada.',
    'calendar.recurrenceDeleted': 'Serie de repeticion eliminada.',
    'calendar.reassignDone': 'Reasignacion completada.',
    'calendar.conflictError': 'Conflicto de horario: el colaborador ya tiene una asignacion en este intervalo.',
    'calendar.saveError': 'Error al guardar asignacion.',
    'calendar.deleteRepeatTitle': 'Eliminar repeticion',
    'calendar.deleteRepeatMessage': 'Elige como deseas eliminar esta asignacion repetida.',
    'calendar.deleteSeries': 'Eliminar serie',
    'calendar.deleteThis': 'Eliminar esta',
    'calendar.deleteAssignmentTitle': 'Eliminar asignacion',
    'calendar.deleteAssignmentMessage': 'Deseas eliminar esta asignacion?',

    'me.title': 'Mi punto',
    'me.subtitle': 'Resumen rapido de tu jornada.',
    'me.upcoming': 'Proximas asignaciones',
    'me.done': 'Completadas',
    'me.pending': 'Pendientes',
    'me.history': 'Historial de trabajo',
    'me.activeCommitments': 'Compromisos activos',
    'me.noUpcoming': 'Sin asignaciones proximas.',
    'me.noHistoryLoaded': 'Sin historial en el periodo cargado.',
    'me.attendanceStatus': 'Estado de fichaje',
    'me.photosCount': 'Fotos',
    'me.punchRecording': 'Registrando fichaje...',
    'me.photosLoading': 'Cargando fotos...',
    'me.punchOffline': 'Sin internet: no se puede fichar en modo offline.',
    'me.checkinSuccess': 'Entrada registrada correctamente.',
    'me.checkoutSuccess': 'Salida registrada correctamente.',
    'me.photosUploadOffline': 'Sin internet: no se pueden enviar fotos en modo offline.',
    'me.photosUploadSuccess': 'Fotos enviadas correctamente.',
    'me.photosUploadError': 'No fue posible enviar las fotos.',
    'me.photoDeleteSuccess': 'Foto eliminada correctamente.',
    'me.photoDeleteError': 'No fue posible eliminar la foto.',
    'me.photoDeleteOffline': 'Sin internet: no se pueden eliminar fotos en modo offline.',
    'me.requestOffline': 'Sin internet: no se puede solicitar ajuste en modo offline.',
    'me.requestSuccess': 'Solicitud enviada al administrador.',
    'me.requestError': 'No fue posible enviar la solicitud.',
    'me.geoNotSupported': 'Geolocalizacion no soportada en este dispositivo.',
    'me.geoFetchError': 'No fue posible obtener la ubicacion actual.',
    'me.punchErrorDefault': 'No fue posible registrar el fichaje.',
    'me.punchErrorOutsideGeofence': 'Estas fuera de la geocerca permitida para este local.',
    'me.punchErrorLocationRequired': 'Para este local, activa la ubicacion del movil para fichar.',
    'me.punchErrorLowAccuracy': 'GPS con baja precision. Intenta de nuevo en una zona abierta.',
    'me.punchErrorCheckinWindowClosed': 'Horario cerrado: el plazo para hacer check-in ya termino.',
    'me.punchErrorCheckinNotOpen': 'Aun no disponible: check-in solo se habilita 30 minutos antes del inicio.',
    'me.punchErrorNeedCheckinFirst': 'Debes hacer check-in antes de registrar la salida.',
    'me.punchErrorInvalidCheckout': 'Horario invalido para check-out.',

    'profile.title': 'Mi perfil',
    'profile.security': 'Seguridad',
    'profile.save': 'Guardar perfil',
    'profile.newPassword': 'Nueva contrasena',
    'profile.confirmPassword': 'Confirmar contrasena',
    'profile.updatePassword': 'Actualizar contrasena',

    'assignment.details': 'Detalles de asignacion',
    'common.close': 'Cerrar',
    'assignment.checkin': 'Marcar entrada',
    'assignment.checkout': 'Marcar salida',

    'assignment.start': 'Inicio',
    'assignment.end': 'Fin',
    'assignment.activityLabel': 'Actividad',
    'assignment.locationLabel': 'Local',
    'assignment.addressLabel': 'Direccion',
    'assignment.detailsLabel': 'Detalles',
    'assignment.punchLabel': 'Fichaje',
    'assignment.notProvidedFemale': 'No informada',
    'assignment.notProvidedMale': 'No informado',
    'assignment.noNotes': 'Sin observaciones',
    'assignment.tabPunch': 'Fichaje',
    'assignment.tabRequest': 'Solicitud de ajuste',
    'assignment.photoBeforeRegistered': 'Foto antes (guardada)',
    'assignment.photoAfterRegistered': 'Foto despues (guardada)',
    'assignment.workPhotosBefore': 'Fotos del trabajo - Antes',
    'assignment.workPhotosAfter': 'Fotos del trabajo - Despues',
    'assignment.previewBefore': 'Vista previa antes',
    'assignment.previewAfter': 'Vista previa despues',
    'assignment.photoBeforeWork': 'Foto antes del trabajo',
    'assignment.photoAfterWork': 'Foto despues del trabajo',
    'assignment.uploadBeforePhotos': 'Enviar fotos antes',
    'assignment.uploadAfterPhotos': 'Enviar fotos despues',
    'assignment.request.title': 'Solicitud de ajuste de fichaje',
    'assignment.request.subtitle': 'Usa esto cuando olvides fichar en el horario correcto.',
    'assignment.request.suggestedType': 'Tipo sugerido',
    'assignment.request.suggestedIn': 'Entrada',
    'assignment.request.suggestedOut': 'Salida',
    'assignment.request.time': 'Horario solicitado',
    'assignment.request.reason': 'Motivo',
    'assignment.request.reasonPlaceholder': 'Ej.: olvide registrar en el momento de la entrada',
    'assignment.request.submit': 'Enviar solicitud',

    'requests.title': 'Mis solicitudes de fichaje',
    'requests.subtitle': 'Sigue aqui las solicitudes enviadas para aprobacion.',
    'requests.refresh': 'Actualizar',
    'requests.typeIn': 'Entrada',
    'requests.typeOut': 'Salida',
    'requests.requestedFor': 'Solicitado para',
    'requests.reason': 'Motivo',
    'requests.noReason': 'Sin motivo informado',
    'requests.assignment': 'Asignacion',
    'requests.adminNote': 'Nota del admin',
    'requests.empty': 'No hay solicitudes registradas.',
    'requests.loadError': 'Error al cargar solicitudes.',

    'calendar.desktopViewAssignments': 'Asignaciones',
    'calendar.desktopViewAttendance': 'Historial de fichaje',
    'calendar.workPhotosCount': 'Fotos del trabajo',
    'calendar.requests.title': 'Solicitudes de ajuste de fichaje',
    'calendar.requests.type': 'Tipo',
    'calendar.requests.requestedFor': 'Solicitado para',
    'calendar.requests.reason': 'Motivo',
    'calendar.requests.noReason': 'Sin motivo informado',
    'calendar.requests.assignment': 'Asignacion',
    'calendar.requests.approve': 'Aprobar',
    'calendar.requests.reject': 'Rechazar',
    'calendar.requests.empty': 'No hay solicitudes pendientes.',
    'calendar.requests.approvedToast': 'Solicitud aprobada.',
    'calendar.requests.rejectedToast': 'Solicitud rechazada.',
    'calendar.attendanceHistory.title': 'Historial de fichaje (ventana cargada)',
    'calendar.attendanceHistory.status': 'Estado',
    'calendar.attendanceHistory.photos': 'Fotos',
    'calendar.attendanceHistory.entry': 'Entrada',
    'calendar.attendanceHistory.exit': 'Salida',
    'calendar.attendanceHistory.empty': 'No hay registros de fichaje en el rango actual.'
  }
};

@Injectable({ providedIn: 'root' })
export class I18nService {
  private readonly languageSignal = signal<AppLanguage>(this.detectInitialLanguage());

  readonly language: Signal<AppLanguage> = this.languageSignal.asReadonly();
  readonly calendarLocaleCode = computed<string>(() => {
    const lang = this.languageSignal();
    if (lang === 'en') {
      return 'en';
    }
    if (lang === 'es') {
      return 'es';
    }
    return 'pt-br';
  });

  setLanguage(language: AppLanguage): void {
    this.languageSignal.set(language);
    localStorage.setItem(STORAGE_KEY, language);
  }

  t(key: string): string {
    const lang = this.languageSignal();
    return DICTIONARY[lang][key] ?? DICTIONARY['en'][key] ?? key;
  }

  private detectInitialLanguage(): AppLanguage {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (stored === 'pt-BR' || stored === 'en' || stored === 'es') {
      return stored;
    }
    return 'en';
  }
}
